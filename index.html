<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Gelişmiş Ülke Savaşı</title>
    <style>
        body { margin: 0; overflow: hidden; background: #0f0f0f; color: white; font-family: sans-serif; }
        #game-canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5; }
        #ui { position: absolute; top: 20px; left: 20px; z-index: 100; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 1px solid #333; pointer-events: auto; }
        .ulke {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, filter 0.3s;
            text-align: center;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 10;
        }
        .secili { outline: 4px solid white; outline-offset: 4px; transform: scale(1.05); z-index: 20 !important; }
        .savas-animasyon { filter: brightness(1.5) contrast(1.2); animation: titreme 0.1s infinite; }
        @keyframes titreme { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, -1px); } }
        .log { position: fixed; bottom: 20px; right: 20px; width: 300px; height: 150px; background: rgba(0,0,0,0.7); overflow-y: auto; padding: 10px; font-size: 12px; border-radius: 5px; }
        kbd { background: #444; padding: 2px 5px; border-radius: 3px; }
    </style>
</head>
<body>

<canvas id="game-canvas"></canvas>

<div id="ui">
    <h2 style="margin-top:0">Dünya Fatihi</h2>
    <p><kbd>Ü</kbd> Ülke Kur / <kbd>S</kbd> Savaş / <kbd>D</kbd> Destek</p>
    <div id="durum">Seçili: Yok</div>
</div>

<div id="log" class="log">Oyun başladı.</div>
<div id="harita"></div>

<script>
    const harita = document.getElementById('harita');
    const log = document.getElementById('log');
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    
    let ulkeler = [];
    let seciliUlke = null;
    let savas DevamEdiyor = false;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    function mesaj(m) {
        const d = document.createElement('div');
        d.innerText = `> ${m}`;
        log.prepend(d);
    }

    // Rastgele Şekil Oluşturucu
    function rastgeleSekil() {
        const noktalar = [];
        for(let i=0; i<8; i++) {
            noktalar.push(`${Math.random()*100}% ${Math.random()*100}%`);
        }
        return `polygon(${noktalar.join(', ')})`;
    }

    function ulkeKur() {
        const ad = prompt("Ülke Adı:");
        if(!ad) return;

        const boyut = 100 + Math.random() * 100;
        const x = Math.random() * (window.innerWidth - boyut);
        const y = Math.random() * (window.innerHeight - boyut);
        const renk = `hsl(${Math.random() * 360}, 70%, 50%)`;
        const sekil = Math.random() > 0.5 ? rastgeleSekil() : 'none';

        const yeni = {
            id: Date.now(),
            ad: ad,
            asker: 100,
            renk: renk,
            x: x, y: y,
            boyut: boyut,
            sekil: sekil,
            div: null
        };

        ulkeler.push(yeni);
        cizUlke(yeni);
        mesaj(`${ad} kuruldu!`);
    }

    function cizUlke(u) {
        const div = document.createElement('div');
        div.className = 'ulke';
        div.style.width = u.boyut + 'px';
        div.style.height = u.boyut + 'px';
        div.style.left = u.x + 'px';
        div.style.top = u.y + 'px';
        div.style.backgroundColor = u.renk;
        if(u.sekil !== 'none') div.style.clipPath = u.sekil;
        else div.style.borderRadius = (Math.random() * 50) + "%";

        div.onclick = () => {
            if(seciliUlke) seciliUlke.div.classList.remove('secili');
            seciliUlke = u;
            div.classList.add('secili');
            document.getElementById('durum').innerText = `Seçili: ${u.ad} (⚔️ ${Math.floor(u.asker)})`;
        };

        u.div = div;
        harita.appendChild(div);
        guncelleMetin(u);
    }

    function guncelleMetin(u) {
        u.div.innerHTML = `<span>${u.ad}<br>⚔️${Math.floor(u.asker)}</span>`;
    }

    async function savas() {
        if(!seciliUlke || savasDevamEdiyor) return;
        const rakipler = ulkeler.filter(u => u.id !== seciliUlke.id);
        if(rakipler.length === 0) return;

        savasDevamEdiyor = true;
        const rakip = rakipler[Math.floor(Math.random() * rakipler.length)];
        mesaj(`${seciliUlke.ad}, ${rakip.ad} ülkesine saldırdı!`);

        seciliUlke.div.classList.add('savas-animasyon');
        rakip.div.classList.add('savas-animasyon');

        const savasDongusu = setInterval(() => {
            // Asker Kayıpları (Rastgelelik ve güç dengesi)
            const saldiri = Math.random() * 5;
            const savunma = Math.random() * 5;

            rakip.asker -= saldiri;
            seciliUlke.asker -= savunma;

            // Animasyon parçacıkları çiz
            cizAskerEfekt(seciliUlke, rakip);

            guncelleMetin(seciliUlke);
            guncelleMetin(rakip);

            if(rakip.asker <= 0 || seciliUlke.asker <= 0) {
                clearInterval(savasDongusu);
                savasBitti(seciliUlke, rakip);
            }
        }, 100);
    }

    function savasBitti(saldıran, savunan) {
        savasDevamEdiyor = false;
        saldıran.div.classList.remove('savas-animasyon');
        savunan.div.classList.remove('savas-animasyon');
        ctx.clearRect(0,0, canvas.width, canvas.height);

        if(savunan.asker <= 0) {
            mesaj(`${savunan.ad} haritadan silindi!`);
            savunan.div.remove();
            ulkeler = ulkeler.filter(u => u.id !== savunan.id);
            saldıran.asker += 50; // Zafer primi
        } else {
            mesaj(`${saldıran.ad} geri çekildi!`);
            saldıran.div.remove();
            ulkeler = ulkeler.filter(u => u.id !== saldıran.id);
            seciliUlke = null;
        }
    }

    function cizAskerEfekt(kaynak, hedef) {
        ctx.clearRect(0,0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = kaynak.renk;
        ctx.lineWidth = 2;
        ctx.moveTo(kaynak.x + kaynak.boyut/2, kaynak.y + kaynak.boyut/2);
        ctx.lineTo(hedef.x + hedef.boyut/2, hedef.y + hedef.boyut/2);
        ctx.stroke();
        
        // Rastgele mermiler/askerler
        for(let i=0; i<5; i++) {
            ctx.fillStyle = "white";
            const t = Math.random();
            const px = (kaynak.x + kaynak.boyut/2) * (1-t) + (hedef.x + hedef.boyut/2) * t;
            const py = (kaynak.y + kaynak.boyut/2) * (1-t) + (hedef.y + hedef.boyut/2) * t;
            ctx.fillRect(px + (Math.random()*20-10), py + (Math.random()*20-10), 4, 4);
        }
    }

    function destek() {
        if(!seciliUlke) return;
        seciliUlke.asker += 30;
        mesaj(`${seciliUlke.ad} asker takviyesi aldı.`);
        guncelleMetin(seciliUlke);
    }

    window.onkeydown = (e) => {
        const key = e.key.toLowerCase();
        if(key === 'ü') ulkeKur();
        if(key === 's') savas();
        if(key === 'd') destek();
    };
</script>

</body>
</html>
